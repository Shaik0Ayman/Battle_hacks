<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scan QR Code - Smart Trolley</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
</head>
<body class="bg-gray-100 text-gray-900 font-sans">

  <!-- Navigation Bar -->
  <nav class="bg-white shadow-md w-full fixed top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <h1 class="text-2xl font-bold text-indigo-600">Smart Trolley</h1>
        <a href="index.html" class="text-gray-700 hover:text-indigo-600 px-3 py-2">Home</a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="min-h-screen flex flex-col justify-center items-center pt-20">
    <h1 class="text-4xl font-bold text-gray-800 mb-6 animate__animated animate__fadeInDown">Scan QR Code</h1>
    <p class="text-lg text-gray-700 mb-8 text-center max-w-xl animate__animated animate__fadeInUp">
      Use the QR scanner below to access detailed product information. You can also manually input the QR code if you're on a desktop.
    </p>

    <!-- QR Scanner -->
    <div id="qr-reader" class="w-full max-w-md bg-white shadow-lg rounded-lg p-6 animate__animated animate__zoomIn"></div>
    <p id="qr-result" class="mt-4 text-lg text-indigo-600 font-semibold hidden">Scanned Result: <span id="result-text"></span></p>

    <!-- Manual Input -->
    <div class="mt-8 w-full max-w-md">
      <label for="manual-input" class="block text-gray-700 font-medium mb-2">Enter QR Code Manually:</label>
      <input id="manual-input" type="text" class="w-full px-4 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-600" placeholder="Enter QR code here">
      <button onclick="processManualInput()" class="mt-4 w-full bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">Submit</button>
      <button onclick="autoFillSimulation()" class="mt-4 w-full bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">Auto-Fill Simulation</button>
    </div>

    <!-- Product Info -->
    <div id="product-info" class="mt-12 w-full max-w-md bg-white shadow-lg rounded-lg p-6 hidden animate__animated animate__fadeIn">
      <h2 class="text-2xl font-bold text-gray-800 mb-4">Product Information</h2>
      <img id="product-image" src="" alt="Product Image" class="w-full h-48 object-cover rounded-lg mb-4">
      <p id="product-name" class="text-lg font-semibold text-gray-800"></p>
      <p id="product-price" class="text-lg text-indigo-600 font-bold"></p>
      <p id="product-description" class="text-gray-700 mt-4"></p>
      <p id="product-expiry" class="text-sm text-gray-600 mt-2"></p>
      <p id="product-status" class="text-sm text-red-600 mt-2 hidden"></p>
      <button onclick="navigateToProductPage()" class="mt-4 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">View Full Details</button>
    </div>

    <!-- Scan History -->
    <div id="scan-history" class="mt-12 w-full max-w-md bg-white shadow-lg rounded-lg p-6">
      <h2 class="text-lg font-bold text-gray-800 mb-4">Scan History</h2>
      <ul id="history-list" class="list-disc pl-6 text-gray-700">
        <!-- Scanned items will be dynamically added here -->
      </ul>
    </div>

    <button onclick="window.location.href='index.html'" class="mt-8 bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700">
      Back to Home
    </button>
  </div>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-4 mt-16">
    <div class="text-center">
      <p>&copy; 2023 Smart Trolley. All rights reserved.</p>
    </div>
  </footer>

  <script>
    const qrReader = new Html5Qrcode("qr-reader");
    const scanHistory = JSON.parse(localStorage.getItem("scanHistory")) || [];

    // Initialize QR Scanner
    qrReader.start(
      { facingMode: "environment" },
      {
        fps: 10,
        qrbox: 250
      },
      (decodedText) => {
        displayProductInfo(decodedText);
      },
      (errorMessage) => {
        console.warn(errorMessage);
      }
    );

    // Process Manual Input
    function processManualInput() {
      const manualInput = document.getElementById("manual-input").value.trim();
      if (manualInput) {
        displayProductInfo(manualInput);
      } else {
        alert("Please enter a valid QR code.");
      }
    }

    // Auto-Fill Simulation
    function autoFillSimulation() {
      const simulatedQR = "12345"; // Example QR code for simulation
      displayProductInfo(simulatedQR);
    }

    // Display Product Info
    function displayProductInfo(qrCode) {
      const productData = {
        "12345": {
          name: "Smartphone",
          price: "₹699",
          description: "A high-end smartphone with excellent features.",
          image: "https://via.placeholder.com/300",
          expiry: "2023-12-31"
        },
        "67890": {
          name: "Wireless Headphones",
          price: "₹199",
          description: "Noise-cancelling wireless headphones.",
          image: "https://via.placeholder.com/300",
          expiry: "2023-11-15"
        }
      };

      const product = productData[qrCode];
      if (product) {
        const isExpired = new Date(product.expiry) < new Date();
        document.getElementById("product-name").textContent = product.name;
        document.getElementById("product-price").textContent = product.price;
        document.getElementById("product-description").textContent = product.description;
        document.getElementById("product-image").src = product.image;
        document.getElementById("product-expiry").textContent = `Expiry: ${product.expiry}`;
        document.getElementById("product-status").textContent = isExpired ? "This product is expired!" : "";
        document.getElementById("product-status").classList.toggle("hidden", !isExpired);

        document.getElementById("product-info").classList.remove("hidden");
        document.getElementById("qr-result").classList.remove("hidden");
        document.getElementById("result-text").textContent = qrCode;

        addToScanHistory(product.name, qrCode);
      } else {
        alert("Product not found for the given QR code.");
      }
    }

    // Add to Scan History
    function addToScanHistory(productName, qrCode) {
      scanHistory.push({ productName, qrCode, timestamp: new Date().toLocaleString() });
      localStorage.setItem("scanHistory", JSON.stringify(scanHistory));
      renderScanHistory();
    }

    // Render Scan History
    function renderScanHistory() {
      const historyList = document.getElementById("history-list");
      historyList.innerHTML = "";
      scanHistory.forEach((item) => {
        const listItem = document.createElement("li");
        listItem.textContent = `${item.productName} (QR: ${item.qrCode}) - ${item.timestamp}`;
        historyList.appendChild(listItem);
      });
    }

    // Navigate to Product Page
    function navigateToProductPage() {
      const productName = document.getElementById("product-name").textContent;
      alert(`Navigating to the product page for: ${productName}`);
      // Logic to redirect to the product page can be added here
    }

    // Initial Render of Scan History
    renderScanHistory();
  </script>
</body>
</html>
