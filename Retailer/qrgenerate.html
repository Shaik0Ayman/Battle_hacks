<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generate QR Code - Smart Trolley</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-900 font-sans">

  <!-- Navigation Bar -->
  <nav class="bg-white shadow-md w-full fixed top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <h1 class="text-2xl font-bold text-indigo-600">Smart Trolley</h1>
        <a href="dashboard.html" class="text-gray-700 hover:text-indigo-600 px-3 py-2">Dashboard</a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="pt-20 px-4 sm:px-6 lg:px-8">
    <h1 class="text-4xl font-bold text-gray-800 mb-6 text-center">ðŸ§¾ Generate QR Code</h1>

    <!-- QR Code Form -->
    <div class="bg-white shadow-lg rounded-lg p-6 mb-8">
      <h2 class="text-lg font-bold text-gray-800 mb-4">Enter Product Details</h2>
      <form id="qr-form" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <input id="product-name" type="text" placeholder="Product Name" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600" required>
        <input id="product-id" type="text" placeholder="Product ID" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600" required>
        <input id="product-price" type="number" placeholder="Price (â‚¹)" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600" required>
        <input id="product-expiry" type="date" placeholder="Expiry Date" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600">
        <textarea id="product-description" placeholder="Product Description" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600 col-span-1 sm:col-span-2 lg:col-span-3"></textarea>
        <select id="qr-color" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600">
          <option value="#000000">Black</option>
          <option value="#FF0000">Red</option>
          <option value="#00FF00">Green</option>
          <option value="#0000FF">Blue</option>
        </select>
        <button type="button" onclick="addToBatch()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">Add to Batch</button>
        <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 col-span-1 sm:col-span-2 lg:col-span-3">Generate QR Code</button>
      </form>
    </div>

    <!-- Batch QR Codes -->
    <div id="batch-display" class="bg-white shadow-lg rounded-lg p-6 hidden">
      <h2 class="text-lg font-bold text-gray-800 mb-4">Batch QR Codes</h2>
      <div id="batch-qr-codes" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
      <button onclick="downloadBatch()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 mt-4">Download All</button>
    </div>

    <!-- QR Code Display -->
    <div id="qr-display" class="bg-white shadow-lg rounded-lg p-6 hidden">
      <h2 class="text-lg font-bold text-gray-800 mb-4">Generated QR Code</h2>
      <div id="qr-code" class="flex justify-center mb-4"></div>
      <button id="download-qr" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">Download QR Code</button>
      <button onclick="resetForm()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 ml-4">Reset</button>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-4 mt-16">
    <div class="text-center">
      <p>&copy; 2023 Smart Trolley. All rights reserved.</p>
    </div>
  </footer>

  <script>
    const qrForm = document.getElementById("qr-form");
    const qrDisplay = document.getElementById("qr-display");
    const qrCodeContainer = document.getElementById("qr-code");
    const downloadButton = document.getElementById("download-qr");
    const batchDisplay = document.getElementById("batch-display");
    const batchQrCodes = document.getElementById("batch-qr-codes");
    const batch = [];

    // Generate QR Code
    // Generate QR Code
    // Generate QR Code
    qrForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = document.getElementById("product-name").value.trim();
      const id = document.getElementById("product-id").value.trim();
      const price = document.getElementById("product-price").value.trim();
      const expiry = document.getElementById("product-expiry").value.trim();
      const color = document.getElementById("qr-color").value;
    
      if (name && id && price) {
        // Include only the required fields in the QR code
        const qrData = JSON.stringify({ name, id, price, expiry });
        qrCodeContainer.innerHTML = ""; // Clear previous QR code
        const canvas = document.createElement("canvas");
        qrCodeContainer.appendChild(canvas); // Append canvas to container
        QRCode.toCanvas(canvas, qrData, { width: 200, color: { dark: color, light: "#FFFFFF" } }, (error) => {
          if (error) {
            console.error("QR Code generation failed:", error);
            alert("Failed to generate QR Code. Please try again.");
          } else {
            qrDisplay.classList.remove("hidden");
          }
        });
      } else {
        alert("Please fill out all required fields.");
      }
    });
    
    // Add to Batch
    function addToBatch() {
      const name = document.getElementById("product-name").value.trim();
      const id = document.getElementById("product-id").value.trim();
      const price = document.getElementById("product-price").value.trim();
      const expiry = document.getElementById("product-expiry").value.trim();
      const color = document.getElementById("qr-color").value;
    
      if (name && id && price) {
        // Include only the required fields in the batch QR code
        const qrData = JSON.stringify({ name, id, price, expiry });
        batch.push({ qrData, color });
        renderBatch();
      } else {
        alert("Please fill out all required fields.");
      }
    }
    
    // Render Batch QR Codes
    function renderBatch() {
      batchQrCodes.innerHTML = "";
      batch.forEach((item, index) => {
        const qrCanvas = document.createElement("canvas");
        QRCode.toCanvas(qrCanvas, item.qrData, { width: 150, color: { dark: item.color, light: "#FFFFFF" } }, (error) => {
          if (error) console.error(error);
        });
        const qrWrapper = document.createElement("div");
        qrWrapper.className = "flex flex-col items-center";
        qrWrapper.innerHTML = `<p class="text-sm text-gray-700 mb-2">QR ${index + 1}</p>`;
        qrWrapper.appendChild(qrCanvas);
        batchQrCodes.appendChild(qrWrapper);
      });
      batchDisplay.classList.remove("hidden");
    }

    // Download Batch QR Codes
    function downloadBatch() {
      batchQrCodes.querySelectorAll("canvas").forEach((canvas, index) => {
        const link = document.createElement("a");
        link.href = canvas.toDataURL("image/png");
        link.download = `qr-code-${index + 1}.png`;
        link.click();
      });
    }

    // Download QR Code
    downloadButton.addEventListener("click", () => {
      const canvas = qrCodeContainer.querySelector("canvas");
      if (canvas) {
        const link = document.createElement("a");
        link.href = canvas.toDataURL("image/png");
        link.download = "qr-code.png";
        link.click();
      } else {
        alert("No QR Code available to download.");
      }
    });

    // Reset Form
    function resetForm() {
      qrForm.reset();
      qrDisplay.classList.add("hidden");
      qrCodeContainer.innerHTML = "";
      batch.length = 0;
      batchDisplay.classList.add("hidden");
    }
  </script>
</body>
</html>
